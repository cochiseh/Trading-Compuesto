<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Tracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div id="appContainer" class="app-container">
        <!-- Header -->
        <header class="header-section" id="mainHeader" style="display:none;">
            <div class="header-left">
                <div class="header-icon">
                    <span class="material-symbols-outlined">candlestick_chart</span>
                </div>
                <div class="header-title" id="appTitle">Portfolio</div>
            </div>
            <div class="header-right">
                <button class="action-icon" id="clearDataBtn" title="Borrar Datos">
                    <span class="material-symbols-outlined">delete</span>
                </button>
                <div class="user-avatar" id="userAvatar">JD</div>
            </div>
        </header>

        <!-- AUTH VIEW -->
        <div id="view-auth" class="view active">
            <div class="auth-container">
                <div class="auth-logo">
                    <span class="material-symbols-outlined" style="font-size: 40px;">shield</span>
                </div>
                <div>
                    <h1 class="auth-title" id="authTitle">Welcome Back</h1>
                    <p class="auth-sub">Track your crypto compound growth.</p>
                </div>
                <div class="auth-form">
                    <form id="authForm">
                        <div class="form-group">
                            <label>Email Address</label>
                            <div class="input-container">
                                <span class="material-symbols-outlined input-icon">mail</span>
                                <input type="email" id="authEmail" placeholder="name@example.com" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <div class="input-container">
                                <span class="material-symbols-outlined input-icon">lock</span>
                                <input type="password" id="authPassword" placeholder="********" required>
                            </div>
                        </div>
                        <div id="authError" class="auth-error"></div>
                        <button type="submit" id="authSubmitBtn" class="btn-primary">Sign In</button>
                    </form>
                    <div class="auth-toggle">
                        <span id="authToggleText">Don't have an account?</span>
                        <a href="#" id="authToggleLink" class="auth-link">Sign Up</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD VIEW -->
        <div id="view-dashboard" class="view">
            <!-- PNL Hero Card -->
            <div class="pnl-hero-card">
                <div class="pnl-hero-content">
                    <div class="pnl-header">
                        <span class="pnl-label">Total Net PNL</span>
                        <div class="pnl-badge positive" id="percentageBadge">
                            <span class="material-symbols-outlined">trending_up</span>
                            <span id="percentageGain">+0%</span>
                        </div>
                    </div>
                    <h1 class="pnl-value" id="totalProfitLoss">+$0.00</h1>
                    <p class="pnl-sub">All time profit since inception</p>
                </div>
                <div class="pnl-stats-grid">
                    <div class="pnl-stat">
                        <span class="pnl-stat-label">Total Trades</span>
                        <span class="pnl-stat-value" id="totalTrades">0</span>
                    </div>
                    <div class="pnl-stat">
                        <span class="pnl-stat-label">Win Rate</span>
                        <span class="pnl-stat-value" id="winRate">0%</span>
                    </div>
                    <div class="pnl-stat">
                        <span class="pnl-stat-label">Win / Loss</span>
                        <span class="pnl-stat-value" id="winLoss">0W / 0L</span>
                    </div>
                </div>
                <div class="pnl-accent-bar"></div>
            </div>

            <!-- Logout Button -->
            <button class="logout-btn" id="logoutBtn">
                <span class="material-symbols-outlined">logout</span>
                Log Out
            </button>

            <!-- Recent Trades -->
            <div class="section-header">
                <h3>Recent Trades</h3>
                <button class="view-all-btn">View All</button>
            </div>
            <div id="tradesList" class="trades-list"></div>
            <div id="emptyState" class="empty-state">
                <span class="material-symbols-outlined">query_stats</span>
                <p>No trades recorded yet.</p>
                <button class="btn-primary btn-small" onclick="switchView('view-log')">Log Initial Capital</button>
            </div>
        </div>

        <!-- LOG TRADE VIEW -->
        <div id="view-log" class="view">
            <div class="view-header">
                <button class="back-btn" onclick="switchView('view-dashboard')">
                    <span class="material-symbols-outlined">close</span>
                </button>
                <h2>Log Trade</h2>
                <div style="width: 40px;"></div>
            </div>

            <div class="form-section">
                <h3>New Entry</h3>
                <p class="form-description">Enter the details of your closed position.</p>
            </div>

            <form id="tradeForm" class="trade-form">
                <div class="form-group">
                    <label>Cryptocurrency Pair</label>
                    <div class="crypto-selector" id="cryptoSelector">
                        <div class="crypto-selected" id="selectedCrypto">
                            <img src="" alt="" class="crypto-logo" id="selectedCryptoLogo" style="display:none;">
                            <span class="material-symbols-outlined search-icon">search</span>
                            <span id="selectedCryptoText">Search asset (e.g. BTC)</span>
                        </div>
                        <span class="material-symbols-outlined dropdown-icon">expand_more</span>
                    </div>
                    <input type="hidden" id="assetName" required>
                </div>

                <div class="form-group">
                    <label>Date Completed</label>
                    <div class="input-container date-input">
                        <input type="date" id="tradeDate" required>
                        <span class="material-symbols-outlined">calendar_today</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>New Total Balance</label>
                    <div class="input-container money-input">
                        <span class="currency-symbol">$</span>
                        <input type="number" id="investedAmount" step="0.01" placeholder="0.00" required>
                    </div>
                    <span class="help-text">Enter the total value of your portfolio after this trade.</span>
                </div>

                <div class="form-group checkbox-group">
                    <input type="checkbox" id="isInitialInvestment">
                    <label for="isInitialInvestment">This is my initial capital</label>
                </div>

                <div class="info-card">
                    <div class="info-content">
                        <h4>Why only final balance?</h4>
                        <p>Since you compound 100% of capital, we only need the final result to calculate your profit
                            automatically.</p>
                    </div>
                    <div class="info-chart">
                        <span class="material-symbols-outlined">show_chart</span>
                    </div>
                </div>

                <button type="submit" class="btn-primary btn-full">
                    <span>Save Trade</span>
                    <span class="material-symbols-outlined">check</span>
                </button>
            </form>
        </div>

        <!-- ANALYTICS VIEW -->
        <div id="view-analytics" class="view">
            <div class="view-header">
                <button class="back-btn" onclick="switchView('view-dashboard')">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h2>Analytics</h2>
                <button class="action-icon">
                    <span class="material-symbols-outlined">ios_share</span>
                </button>
            </div>

            <div class="equity-card">
                <span class="equity-label">TOTAL EQUITY</span>
                <h1 id="analyticsEquity">$0.00</h1>
                <div class="equity-badge positive" id="equityBadge">
                    <span class="material-symbols-outlined">trending_up</span>
                    <span id="equityPercent">+0%</span>
                    <span class="equity-period">(All time)</span>
                </div>
            </div>

            <div class="chart-container">
                <svg viewBox="0 0 375 180" preserveAspectRatio="none" class="equity-chart">
                    <defs>
                        <linearGradient id="chartGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#22c55e;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#22c55e;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <path id="chartFill" d="" fill="url(#chartGradient)"></path>
                    <path id="chartLine" d="" fill="none" stroke="#22c55e" stroke-width="2"></path>
                    <circle id="chartActivePoint" cx="0" cy="0" r="5" fill="#22c55e" class="hidden"></circle>
                </svg>
            </div>

            <div class="metrics-section">
                <h3><span class="material-symbols-outlined">insights</span> Key Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">AVG. GAIN</span>
                            <span class="material-symbols-outlined metric-icon profit">trending_up</span>
                        </div>
                        <span id="statAvgGain" class="metric-value profit">+0%</span>
                        <span class="metric-sub">per trade</span>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">BEST TRADE</span>
                            <span class="material-symbols-outlined metric-icon profit">rocket_launch</span>
                        </div>
                        <span id="statBestTrade" class="metric-value profit">+0%</span>
                        <span id="statBestTradeAsset" class="metric-sub">---</span>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">WORST TRADE</span>
                            <span class="material-symbols-outlined metric-icon loss">trending_down</span>
                        </div>
                        <span id="statWorstTrade" class="metric-value loss">0%</span>
                        <span id="statWorstTradeAsset" class="metric-sub">---</span>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">
                            <span class="metric-label">PROFIT FACTOR</span>
                            <span class="material-symbols-outlined metric-icon">balance</span>
                        </div>
                        <span id="statProfitFactor" class="metric-value">0.00</span>
                        <span id="statProfitFactorText" class="metric-sub">Neutral</span>
                    </div>
                </div>
            </div>

            <div class="monthly-section">
                <div class="section-header">
                    <h3><span class="material-symbols-outlined">calendar_month</span> Monthly Returns</h3>
                    <button class="view-all-btn">View report</button>
                </div>
                <div id="monthlyList" class="monthly-list"></div>
            </div>
        </div>

        <!-- PROFILES VIEW -->
        <div id="view-profile" class="view">
            <div class="view-header">
                <button class="back-btn" onclick="switchView('view-dashboard')">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h2>Accounts</h2>
                <div style="width: 40px;"></div>
            </div>

            <form id="createProfileForm" class="profile-form">
                <div class="form-group">
                    <label>New Portfolio Name</label>
                    <div class="input-container">
                        <input type="text" id="newProfileName" placeholder="My Trading Account..." required>
                        <button type="submit" class="btn-icon">
                            <span class="material-symbols-outlined">add</span>
                        </button>
                    </div>
                </div>
            </form>

            <div class="section-header">
                <h3>My Accounts</h3>
            </div>
            <div id="profileList" class="profile-list"></div>
        </div>

        <!-- Navigation Bar -->
        <nav class="bottom-nav" id="bottomNav">
            <div class="nav-item active" data-target="view-dashboard">
                <span class="material-symbols-outlined">dashboard</span>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" data-target="view-analytics">
                <span class="material-symbols-outlined">insights</span>
                <span>Analytics</span>
            </div>
            <div class="nav-item fab-item" data-target="view-log">
                <div class="fab-circle">
                    <span class="material-symbols-outlined">add</span>
                </div>
            </div>
            <div class="nav-item" data-target="view-profile">
                <span class="material-symbols-outlined">account_balance_wallet</span>
                <span>Accounts</span>
            </div>
        </nav>

        <!-- Crypto Selector Modal -->
        <div id="cryptoModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Select Cryptocurrency</h3>
                    <button class="modal-close" id="closeCryptoModal">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="modal-search">
                    <span class="material-symbols-outlined">search</span>
                    <input type="text" id="cryptoSearch" placeholder="Search coins...">
                </div>
                <div class="crypto-favorites" id="cryptoFavorites">
                    <span class="favorites-label">Frequently Used</span>
                    <div class="favorites-list" id="favoritesList"></div>
                </div>
                <div class="crypto-list" id="cryptoList"></div>
                <div class="custom-crypto">
                    <button id="addCustomCrypto" class="btn-secondary">
                        <span class="material-symbols-outlined">add_circle</span>
                        Add Custom Token
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>